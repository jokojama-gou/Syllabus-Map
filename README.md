
---

## **要件定義書（詳細版）：SFC教室利用状況可視化システム**

文書バージョン: 1.1  
作成日: 2025年10月16日

### **1\. 概要**

#### **1.1. プロジェクトの背景と目的**

慶應義塾大学湘南藤沢キャンパス（SFC）では、学生や教職員が授業時間外に利用可能な空き教室を探す際、シラバスや掲示を個別に確認する必要があり、非効率的である。  
本プロジェクトは、シラバスのHTMLデータから授業配置情報を自動的に抽出し、特定の時間帯における各教室の利用状況を直感的に可視化するシステムを開発することを目的とする。  
これにより、空き教室情報の検索性を劇的に向上させ、キャンパスリソースの有効活用を促進する。

#### **1.2. ターゲットユーザー**

* 慶應義塾大学湘南藤沢キャンパス（SFC）の学生および教職員

#### **1.3. プロジェクトの構成**

本プロジェクトは、全成果物の根幹となる\*\*「フェーズ1：共通データ基盤」**と、それを利用する2つの独立したアウトプット**「フェーズ2：Google Sheets ジェネレーター」**および**「フェーズ3：Webアプリケーション」\*\*から構成される。


ファイル構成は以下の通り：

sfc-room-viz/
├── .gitignore                    # Gitで管理しないファイルを指定（例: venv/, node_modules/, *.log）
├── README.md                     # プロジェクトの概要、セットアップ手順、実行方法（F-02-01）を記述
├── requirements.txt              # Pythonの依存ライブラリ一覧（BeautifulSoup4, pandas, gspreadなど）
├── package.json                  # Webアプリ（React）の依存ライブラリ一覧
├── syllabus.html                 # 【入力データ】要件F-01-01で指定されたシラバスの元データ

├── settings/                     # 静的な設定ファイル群（非機能要件: 保守性）
│   ├── map.json                  # 【入力データ】教室のレイアウト定義（F-01-04）
│   └── config.py                 # F-02のGoogle Sheets ID、利用中カラーコードなどを定義
│
├── data/                         # 生成されるデータ出力先
│   └── syllabus.json             # 【出力データ/共通基盤】抽出・正規化された授業データ（F-01-03）
│
├── src/                          # 共通のデータ処理ロジックをまとめるディレクトリ
│   ├── __init__.py               # Pythonモジュールとして認識させるためのファイル
│   └── parser.py                 # HTMLパース（F-01-01）とデータ正規化（F-01-02）のコアロジックを関数として定義
│
├── scripts/                      # コマンドラインから実行されるPythonスクリプト群（F-02）
│   ├── generate_data.py          # parser.pyを利用してsyllabus.html → data/syllabus.jsonを生成する（F-01全体を実行）
│   └── generate_sheet.py         # Google Sheetsジェネレーター本体（F-02-01〜F-02-05）
│
└── web/                          # Webアプリケーションのソースコード（F-03）
    └── react-app/                # Reactプロジェクトの標準構成を採用
        ├── public/               # index.htmlやfaviconなどの静的ファイル
        │   └── index.html
        │
        └── src/                  # Reactのコンポーネントとロジック
            ├── components/       # UI部品のコンポーネント（F-03-04）
            │   ├── TimeSelector.js     # 曜日・時限選択UI（F-03-02）
            │   ├── CampusMap.js        # 地図表示エリア（F-03-01, F-03-03）
            │   └── Tooltip.js          # 詳細情報ツールチップ（F-03-04）
            │
            ├── App.js            # メインコンポーネント（状態管理、データ読み込み）
            ├── index.js          # エントリーポイント
            └── styles/           # CSSファイル（F-03-03の利用中ハイライトの定義など）

---

### **2\. 前提条件・制約事項**

* **入力データ**:  
  * シラバスデータは、syllabus.htmlというファイル名で、UTF-8エンコーディングのHTML形式で提供されるものとする。  
  * 本システムは、提供されたHTMLファイルの構造に依存する。大幅な構造変更があった場合は、データ抽出ロジックの修正が必要となる。  
* **実行環境**:  
  * Pythonスクリプトの実行環境（Python 3.10以上）および、指定ライブラリのインストールは完了しているものとする。  
  * Google Sheets APIの利用に必要なサービスアカウントの認証情報ファイル（credentials.json）は、事前に取得・配置済みであること。  
* **システムアーキテクチャ**:  
  * Webアプリケーションは、サーバーサイドの処理を必要としない静的なWebページ（HTML/CSS/JavaScript）として構築する。データ処理はすべてクライアント（ブラウザ）側で完結する。

---

### **3\. スコープ**

#### **3.1. スコープ内（本プロジェクトで実施すること）**

* syllabus.htmlから授業情報を抽出し、JSONファイル（syllabus.json）を生成する機能。  
* 教室のレイアウト情報を定義したJSONファイル（map.json）の仕様策定。  
* 上記2つのJSONファイルを入力とし、指定した時限の教室マップをGoogle Sheets上に描画するPythonスクリプトの開発。  
* 上記2つのJSONファイルを入力とし、ブラウザ上でインタラクティブに教室利用状況を閲覧できるWebアプリケーションの開発。

#### **3.2. スコープ外（本プロジェクトで実施しないこと）**

* シラバスHTMLのWebからの自動取得・更新機能。  
* ユーザー認証、ログイン機能。  
* 教室の予約・申請機能。  
* データベースを用いたデータの永続的な管理。  
* 過去の学期データとの連携。

---

### **4\. 機能要件（詳細）**

#### **4.1. 【F-01】共通データ基盤**

| ID | 要件概要 | 詳細仕様 | 備考（エラーハンドリング等） |
| :---- | :---- | :---- | :---- |
| **F-01-01** | **シラバスデータの抽出** | ・入力: syllabus.html (UTF-8) ・処理: PythonのBeautifulSoup4ライブラリを使用し、授業情報が含まれるHTMLのテーブル要素（例: \<table\>内の特定の\<tr\>）を走査する。 ・抽出項目: 「科目名」「担当者」「曜日・時限・教室」のテキスト情報を抽出する。 | 抽出対象のHTML要素が見つからない場合は、エラーメッセージを表示して処理を中断する。 |
| **F-01-02** | **時間割データの正規化** | ・入力: 「曜日・時限・教室」の複合文字列 ・処理: pandasと正規表現を用い、以下のパターンを解析し、\[曜日, 時限, 教室\]の組に分解する。 \- 月1:ε12, 火2:ο13 → \["月", 1, "ε12"\], \["火", 2, "ο13"\] \- 水3,4:κ11 → \["水", 3, "κ11"\], \["水", 4, "κ11"\] ・時限は数値型に変換する。 | 解析できないフォーマットの文字列が検出された場合、警告をログに出力し、そのデータはスキップして処理を続行する。 |
| **F-01-03** | **授業データのエクスポート** | ・処理: 正規化された全授業データをpandas DataFrame経由でJSON形式に変換する。 ・出力: syllabus.json (UTF-8)。JSONはオブジェクトの配列形式とする。 | ファイルへの書き込みに失敗した場合は、例外を捕捉しエラーメッセージを表示する。 |
| **F-01-04** | **地図レイアウトの定義** | ・手動でmap.jsonファイルを作成・編集する。 ・このファイルは、教室IDと画面上の幾何学的情報を紐付ける役割を持つ。 ・startCell, endCell はA1形式のセル参照文字列とする。 ・labelCellは、教室名の表示および授業名の書き込み位置を兼ねる。原則としてstartCellと同じ値とする。 | JSONのフォーマットが不正な場合は、利用するプログラム側でパースエラーとして検知・報告する必要がある。 |

**データフォーマット仕様（syllabus.json）**

| キー | データ型 | 必須/任意 | 説明・制約 |
| :---- | :---- | :---- | :---- |
| subject | String | 必須 | 科目名。空文字列は不可。 |
| teacher | String | 必須 | 担当教員名。 |
| day | String | 必須 | "月", "火", "水", "木", "金", "土", "日" のいずれか。 |
| period | Integer | 必須 | 1〜8の整数。 |
| room | String | 必須 | 教室コード（例: "ε18"）。 |

**データフォーマット仕様（map.json）**

| パス | キー | データ型 | 必須/任意 | 説明・制約 |
| :---- | :---- | :---- | :---- | :---- |
| settings | columnWidth | Integer | 任意 | Google Sheetsでのデフォルト列幅。 |
| settings | rowHeight | Integer | 任意 | Google Sheetsでのデフォルト行高。 |
| rooms\[\] | id | String | 必須 | 教室の一意な識別子。syllabus.jsonのroomと対応。 |
| rooms\[\] | name | String | 必須 | 表示用の教室名。 |
| rooms\[\] | startCell | String | 必須 | 描画範囲の開始セル（例: "A5"）。 |
| rooms\[\] | endCell | String | 必須 | 描画範囲の終了セル（例: "C10"）。 |
| rooms\[\] | labelCell | String | 必須 | 科目名を書き込む基準セル。 |

---

#### **4.2. 【F-02】Google Sheets ジェネレーター**

| ID | 要件概要 | 詳細仕様 |
| :---- | :---- | :---- |
| **F-02-01** | **実行インターフェース** | ・Pythonスクリプトとしてコマンドラインから実行可能であること。 ・実行時に曜日と時限をコマンドライン引数で指定する。（例: python generate\_sheet.py \--day 月 \--period 1） ・引数が指定されない、または不正な場合は、使用方法を表示して終了する。 |
| **F-02-02** | **シートの初期化** | ・描画対象のGoogle Sheet（事前にIDで指定）を開き、全てのセル結合を解除する。 ・A1からZZ100の範囲のセルの背景色を白（\#FFFFFF）に設定し、値をクリアする。 |
| **F-02-03** | **マップ描画** | ・map.jsonを読み込み、rooms配列をループ処理する。 ・各教室について、startCellとendCellで定義される範囲を結合し、枠線を設定する。 ・labelCellに教室名（nameキーの値）を書き込む。 |
| **F-02-04** | **利用状況の着色** | ・指定された曜日・時限に利用されている教室をsyllabus.jsonから検索する。 ・該当する教室のセル範囲の背景色を、指定の利用中カラー（例: \#DDEEFF）に変更する。 |
| **F-02-05** | **授業情報の書き込み** | ・利用中の教室について、labelCellに「教室名 科目名」の形式で改行を含めて書き込む。 ・セルの書式を「折り返して全体を表示する」に設定する。 |

---

#### **4.3. 【F-03】Webアプリケーション**

| ID | 要件概要 | 詳細仕様 |
| :---- | :---- | :---- |
| **F-03-01** | **画面構成と初期表示** | ・画面はヘッダー、時限選択エリア、地図表示エリアから構成される。 ・アプリケーション読み込み完了後、map.jsonに基づき全教室をCSSで配置し、初期状態（月曜1限など、あらかじめ定められた時限）の利用状況を表示する。 |
| **F-03-02** | **時限選択UI** | ・曜日選択: \<select\>ドロップダウンリストで、「月」〜「土」を選択可能。デフォルトは「月」。 ・時限選択: 1〜7限の\<button\>要素を横一列に配置。選択中のボタンはスタイルを変更してアクティブ状態を示す。デフォルトは「1」。 ・いずれかの選択が変更されると、地図表示が即座に更新される。 |
| **F-03-03** | **動的なハイライト** | ・ユーザーが時限を選択すると、アプリケーションのState（状態）が更新される。 ・Reactのリアクティブ機能により、新しいStateに基づいて再描画がトリガーされる。 ・選択された時限に利用されている教室コンポーネントにのみ、特別なCSSクラス（例: classroom--active）が付与され、背景色が利用中カラー（例: \#DDEEFF）に変化する。 |
| **F-03-04** | **詳細情報のツールチップ表示** | ・利用中・空きに関わらず、全ての教室要素にonMouseEnterおよびonMouseLeaveイベントハンドラを設定する。 ・onMouseEnter: マウスカーソル直下にツールチップを表示。表示内容は以下とする。 \- **利用中の場合**: 「教室名」「科目名」「担当教員名」 \- **空きの場合**: 「教室名」「（空き）」 ・onMouseLeave: ツールチップを非表示にする。 |

---

### **5\. 非機能要件**

| 項目 | 要件 | 測定基準 |
| :---- | :---- | :---- |
| **性能** | Webアプリケーションでの時限選択から画面更新までの応答が速やかであること。 | ユーザーの時限選択操作後、地図のハイライトが更新完了するまでの時間が95パーセンタイルで500ミリ秒以内。 |
| **保守性** | ・シラバスHTMLのセレクタや地図座標、色設定など、将来変更される可能性が高い値は、コードの冒頭や独立した設定ファイルに定数として定義すること。 ・Reactコンポーネントは機能ごとにファイル分割（例: TimeSelector.js, CampusMap.js）し、Propsによるデータの受け渡しを適切に行うこと。 | コードレビューにて、設定値のハードコーディングがないこと、コンポーネントの責務が単一であることを確認。 |
| **UI/UX** | 専門知識がないユーザーでも直感的に操作できること。 | ターゲットユーザー（学生）によるユーザビリティテストで、主要なタスク（特定の時限の空き教室を探す）を説明なしで完了できる割合が90%以上。 |
| **互換性** | 主要なモダンブラウザで表示や機能が崩れないこと。 | Google Chrome, Mozilla Firefox, Apple Safari, Microsoft Edge の最新メジャーバージョンで正常に動作すること。 |
| **セキュリティ** | 本システムが個人情報や機密情報を漏洩させないこと。 | Webアプリケーションはクライアントサイドのみで完結し、外部サーバーへのデータ送信を行わない設計とする。 |
